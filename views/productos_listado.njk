{% extends "base.njk" %}

{% block titulo %}Productos | Listado{% endblock %}

{% block contenido %}
    {% set year2024 = 2024 %}
    {% set year2025 = 2025 %}
    {% set year2026 = 2026 %}
    
    <h1>Listado de productos</h1>
    {% if productos.length === 0 %}
        <p class="text-info">No hay productos en el listado</p>
    {% endif %}
    
    <p>
        <button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#collapse2024" aria-expanded="false" aria-controls="collapse2024">
            2024
        </button>
        <button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#collapse2025" aria-expanded="false" aria-controls="collapse2025">
            2025
        </button>
        <button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#collapse2026" aria-expanded="false" aria-controls="collapse2026">
            2026
        </button>
        <button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#collapseAll" aria-expanded="false" aria-controls="collapseAll">
            Cat√°logo Completo
        </button>
    </p>    
    <div class="collapse" id="collapse2024">
        <div class="row">
            {% for producto in productos %}
                {% if producto.caducidad | date("YYYY") == year2024 %}
                    <div class="col-lg-4 col-md-6 p-2">
                        <div class="card shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title bg-light rounded">EAN: {{ producto.ean }}</h5>
                                <p class="card-text">Nombre: {{ producto.nombre }}</p>
                                <p class="card-text">caducidad: {{ producto.caducidad |  date('DD-MM-YYYY') }}</p>
                                <a href="/productos/{{ producto.id }}"" class="btn btn-primary">Ver ficha</a>
                            </div>
                        </div>
                    </div>
                {% endif %} 
            {% endfor %}
        </div>
    </div>
    <div class="collapse" id="collapse2025">
        <div class="row">
            {% for producto in productos %}
                {% if producto.caducidad | date("YYYY") == year2025 %}
                    <div class="col-lg-4 col-md-6 p-2">
                        <div class="card shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title bg-light rounded">EAN: {{ producto.ean }}</h5>
                                <p class="card-text">Nombre: {{ producto.nombre }}</p>
                                <p class="card-text">caducidad: {{ producto.caducidad |  date('DD-MM-YYYY') }}</p>
                                <a href="/productos/{{ producto.id }}"" class="btn btn-primary">Ver ficha</a>
                            </div>
                        </div>
                    </div>
                {% endif %} 
            {% endfor %}
        </div>
    </div>
    <div class="collapse" id="collapse2026">
        <div class="row">
            {% for producto in productos %}
                {% if producto.caducidad | date("YYYY") == year2026 %}
                    <div class="col-lg-4 col-md-6 p-2">
                        <div class="card shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title bg-light rounded">EAN: {{ producto.ean }}</h5>
                                <p class="card-text">Nombre: {{ producto.nombre }}</p>
                                <p class="card-text">caducidad: {{ producto.caducidad |  date('DD-MM-YYYY') }}</p>
                                <a href="/productos/{{ producto.id }}"" class="btn btn-primary">Ver ficha</a>
                            </div>
                        </div>
                    </div>
                {% endif %} 
            {% endfor %}
        </div>
    </div>
    <div class="collapse" id="collapseAll">
        <div class="row">
            {% for producto in productos %}
                <div class="col-lg-4 col-md-6 p-2">
                    <div class="card shadow-sm">
                        <div class="card-body">
                            <h5 class="card-title bg-light rounded">EAN: {{ producto.ean }}</h5>
                            <p class="card-text">Nombre: {{ producto.nombre }}</p>                                <p class="card-text">caducidad: {{ producto.caducidad |  date('DD-MM-YYYY') }}</p>
                            <a href="/productos/{{ producto.id }}"" class="btn btn-primary">Ver ficha</a>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous">
    </script>
    <script>
    document.addEventListener('DOMContentLoaded', function () {
        var collapseElementList = [].slice.call(document.querySelectorAll('.collapse'))
        var collapseList = collapseElementList.map(function (collapseEl) {
            return new bootstrap.Collapse(collapseEl, {
                toggle: false
            })
        })

        document.querySelectorAll('[data-bs-toggle="collapse"]').forEach(function (btn) {
            btn.addEventListener('click', function () {
                var target = document.querySelector(this.getAttribute('data-bs-target'))
                collapseList.forEach(function (collapseInstance) {
                    if (collapseInstance._element !== target && collapseInstance._element.classList.contains('show')) {
                        collapseInstance.hide()
                    }
                })
            })
        })
    });
</script>
{% endblock %}